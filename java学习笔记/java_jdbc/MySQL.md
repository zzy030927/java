<a name="M8Ud0"></a>
## 一、存储引擎InnoDB
<a name="zBkf6"></a>
#### 1.1 MySQL体系结构图
![61BA024E9E611525D1CE0355D092FE8B.jpg](https://cdn.nlark.com/yuque/0/2023/jpeg/35506053/1680768887663-ee4d2686-dd72-41f5-a3f1-fe1f86d914ba.jpeg#averageHue=%23f9faf5&clientId=uc1a2ec54-6358-4&from=paste&height=311&id=uedb1ee3e&originHeight=741&originWidth=1466&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=102198&status=done&style=none&taskId=ue54aebff-90ac-4407-866a-bb9ef7fe736&title=&width=615)
<a name="MVLeD"></a>
#### 1.2 各层的作用

      - **连接层**
:::info
最上层是客户端连接服务，主要完成类似于连接处理、授权认证、及相关的安全方案，连接层的主要作用是用于连接数据库。
:::

      - **服务层**
:::info
SQL Interface(SQL接口，用来接受用户的SQL命令，并返回需要的结果)，用户写的SQL语句会到服务层进行解析，生成语法树。优化SQL语句，生成执行方案。所有跨存储引擎的功能也在这一层实现，如：过程、函数等。
:::

      - **引擎层**
:::info
存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎通信，不同的存储引擎具有不同的功能。<br />存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。不同的存储引擎提供不同的存储机制、索引技巧、锁定水平等功能，使用不同的存储引擎，还能获得特定的功能，存储引擎是基于表的，不是基于库的，所以存储引擎也可以被称为表类型。
:::

      - **存储层**
:::info
将数据存储在文件系统之上，并完成与存储引擎之间的交互。
:::
<a name="Z7HFg"></a>
#### 	1.3 InnoDB存储引擎与MyISAM存储引擎之间的区别
<a name="Qaoci"></a>
##### 1.3.1 InnoDB存储引擎
:::info

- InnoDB是MySQL默认的存储引擎，它被用来处理大量的短期事务。可以确保事务的完整提交(commit)和回滚(rollback)，而MyISAM不支持事务处理。
- 除了增加和查询外，还需要更新、删除操作，那么，应优先选择InnoDB存储引擎，如果光进行查询和增加数据，那么选择 MyISAM更好
- 存储结构：
   - 表名.frm 存储表结构
   - 表明.ibd 存储数据和索引
- InnoDB是为处理巨大数据量的最大性能设计
   - 在以前的版本中，字典数据以元数据文件、非事务表等来存储。现在这些元数据文件等被删除。比如：.par，.trn，.isl 等文件都在 MySQL 8.0中消失了。
- InnnoDB支持外键约束，而 MyISAM不支持
:::
<a name="RIiPr"></a>
##### 	     1.3.2 InnoDB存储引擎 与 MyISM存储引擎优缺点对比
:::info

- MyISAM引擎：主要的非事务处理存储引擎，建议使用场景：以读为主的业务。
- MyISAM提供了大量的特性，包括全文索引、压缩、空间函数等。但MyISAM不支持事务、行级锁、外键，有一个毫无疑问的缺点就是崩溃后无法恢复。
- InnoDB支持事务处理，支持外键约束，适合处理大量数据。
- 而MyISAM存储引擎对比InnoDB存储引擎处理效率要好一些，并且会占用更少的磁盘空间以保存数据和索引。
- MyISAM只缓存索引，不缓存真实数据；InnoDB不仅缓存索引还要缓存真实数据，对内存要求比较高，而且内存大小对性能有决定性的作用。
:::
<a name="xRaNy"></a>
#####     1.3.3  Archive、CSV、Memory等存储引擎的使用
<a name="ZjJ5m"></a>
###### 1.3.3.1 Archive引擎：用于数据存档
:::info

- archive是 归档 的意思，仅仅支持 插入 和 查询两种功能（行被插入后不能更改）。
- 拥有很好的压缩机制，使用 zlib压缩库，在记录请求的时候进行压缩，经常被用来作为仓库使用。

优点：

- 同样数据量下，Archive表比MyISAM表要小大约75%，比支持事务处理的InnoDB表小大约83%。
- Archive存储引擎采用了行级锁。
- 适合于日志采集和归档类应用。适合存储大量独立的作为历史记录的数据，拥有很高的插入速度，但是对查询的支持较差。
:::
<a name="zRs7n"></a>
###### 		   1.3.3.2 Blackhole引擎：丢弃写操作，读操作会返回空内容
:::info

- Blackhole引擎没有实现任何存储机制，它会丢弃所有插入的数据，不做任何保存。
- 但服务器会记录Blackhole表的日志，所有可以用于复制数据到备库，或者简单的记录到日志，但是这种应用方式会碰到很多问题，不推荐使用。
:::
<a name="NaLws"></a>
######          	 1.3.3.3 CSV引擎：存储引擎时，以逗号分割各个数据项
:::info

- CSV引擎可以将普通的CSV文件作为MySQL的表处理，但不支持索引。
- CSV引擎可以作为一种数据交换的机制，非常实用。
- CSV引擎的数据可以直接在操作系统里，用文本编辑器，或者excel读取。
- 对于数据的快速导入，导出是有明显优势的。
- CSV存储引擎不支持数据字段为空的存储，所以当表选择存储引擎为 CSV 时，每个字段后面都要加入 NOT NULL 限定符。
:::
<a name="dUln6"></a>
######    1.3.3.4 Memory引擎：置于内存的表
**概述**
:::info
Memory采用的逻辑介质是内存，响应速度快，但是当mysqld守护进程崩溃的时候数据会丢失。另外，要求存储的数据长度不变的格式。
:::
**主要特征**
:::info
Memory引擎默认使用的是哈希索引，速度比B树索引快，但是支持的数据类型有限，不支持Blob和Text类型，如果存入VARCHAR类型的数据，那么会自动转换为CHAR类型，总体而言，Memory存储引擎对比InnoDB存储引擎毫无竞争力，但Memory存储引擎有极高的插入、更新和查询效率。
:::
<a name="Jk8Ps"></a>
## 二、索引的数据结构
<a name="cJHjq"></a>
#### 2.1 为什么要使用索引
:::info
索引是存储引擎用于快速找到数据的一种数据结构，进行查找数据时，首先查看查询条件是否命中某条索引，符合则通过索引查找相关数据，如果不符合则需要全表扫描，即需要一条一条地查找记录，直到找到与条件符合的记录。<br />建立索引的目的就是为了减少磁盘 I/O 的次数，加快查询效率。
:::
:::info
索引是在存储引擎中实现的，因为每一种存储引擎的索引不一定完全相同，并且每种存储引擎不一定支持索引索引类型。同时，存储引擎可以定义每个表的最大索引和最大索引长度，所有存储引擎支持每个表最少16个索引，总索引长度最少256个字节，有些存储引擎支持更多的索引数和更大的索引长度。
:::
<a name="X0mde"></a>
#### 2.2 索引的优缺点
:::info
优点：

   1. 降低数据库和磁盘的 IO 成本，这也是创建数据库的主要原因。
   2. 通过创建唯一索引，可以保证数据库表中每一行数据的唯一性。
   3. 在实现数据的参考完整性方面，可以加速表和表之间的连接，换句话说，对于由依赖关系的子表和附表联合查询时，可以提高查询速度。
   4. 在使用分组和排序子句进行查询数据时，可以显著减少查询中分组和排序的时间，降低了CPU的消耗。

缺点：

   1. 创建索引和维护索引要耗费时间，并且随着索引的增加，所消耗的时间也会增加。
   2. 索引需要磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，存储在磁盘上，如果有大量的索引，索引文件就可能比数据文件更快的达到最大文件尺寸。
   3. 虽然索引大大提高了查询速度，但是会降低更新表的速度，当对表中的数据进行增加，删除和修改的时候，索引也要动态的去维护，这样就降低了数据的维护速度。
:::






